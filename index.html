<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NEET PG Quiz - Home</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #eef4ff;
    margin: 20px;
    color: #222;
  }
  h1 {
    color: #344ea3;
    text-align: center;
    margin-bottom: 10px;
  }
  #subjectContainer {
    max-width: 900px;
    margin: auto;
  }
  h2 {
    margin-top: 30px;
    color: #344ea3;
    border-bottom: 2px solid #344ea3;
    padding-bottom: 5px;
  }
  .subject-card {
    display: inline-block;
    width: 210px;
    height: 130px;
    margin: 10px;
    border-radius: 12px;
    color: #fff;
    padding: 20px;
    box-sizing: border-box;
    position: relative;
    cursor: pointer;
    user-select: none;
    transition: transform 0.2s ease;
  }
  .subject-card:hover {
    transform: scale(1.05);
  }
  .lock-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .lock-overlay button {
    margin-top: 10px;
    background: #f44336;
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9rem;
  }
  .lock-overlay button:hover {
    background: #d32f2f;
  }
  #logoutBtn {
    position: fixed;
    top: 20px; right: 20px;
    background: #c0392b;
    border: none;
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    display: none;
  }
</style>
</head>
<body>

<h1>NEET PG Quiz Subjects</h1>

<div id="subjectContainer"></div>

<button id="logoutBtn">Logout</button>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDr3_9dpo55esyfpkwsAjfFi_1KMu0ZDrU",
    authDomain: "neet-88499.firebaseapp.com",
    projectId: "neet-88499",
    storageBucket: "neet-88499.firebasestorage.app",
    messagingSenderId: "889163298965",
    appId: "1:889163298965:web:fbae28b0ba478cff2f839c",
    measurementId: "G-GEG090K2JQ"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const razorpayKey = "rzp_live_7nZptAUoDrsfRb";

  const subjects = [
    { name: "Anatomy", year: "1st Year", color: "#f44336" },
    { name: "Physiology", year: "1st Year", color: "#e91e63" },
    { name: "Biochemistry", year: "1st Year", color: "#9c27b0" },
    { name: "Pathology", year: "2nd Year", color: "#673ab7" },
    { name: "Pharmacology", year: "2nd Year", color: "#3f51b5" },
    { name: "Microbiology", year: "2nd Year", color: "#2196f3" },
    { name: "Forensic Medicine", year: "2nd Year", color: "#03a9f4" },
    { name: "Community Medicine", year: "3rd Year", color: "#00bcd4" },
    { name: "ENT", year: "3rd Year", color: "#009688" },
    { name: "Ophthalmology", year: "3rd Year", color: "#4caf50" },
    { name: "General Medicine", year: "Final Year", color: "#8bc34a" },
    { name: "General Surgery", year: "Final Year", color: "#cddc39" },
    { name: "Obstetrics & Gynaecology", year: "Final Year", color: "#ffeb3b" },
    { name: "Pediatrics", year: "Final Year", color: "#ffc107" },
    { name: "Orthopaedics", year: "Final Year", color: "#ff9800" },
    { name: "Dermatology", year: "Final Year", color: "#ff5722" },
    { name: "Psychiatry", year: "Final Year", color: "#795548" },
    { name: "Respiratory Medicine", year: "Final Year", color: "#9e9e9e" },
    { name: "Anesthesiology", year: "Final Year", color: "#607d8b" }
  ];

  const subjectContainer = document.getElementById("subjectContainer");
  const logoutBtn = document.getElementById("logoutBtn");

  function createSubjectCard(subject, unlocked) {
    const card = document.createElement("div");
    card.className = "subject-card";
    card.style.backgroundColor = subject.color;
    card.textContent = subject.name;
    card.title = `${subject.name} - ${subject.year}`;

    if (!unlocked) {
      card.style.cursor = "default";
      const overlay = document.createElement("div");
      overlay.className = "lock-overlay";
      overlay.innerHTML = `
        <div style="font-size: 36px;">ðŸ”’</div>
        <button>Pay â‚¹99 to Unlock</button>
      `;
      overlay.querySelector("button").onclick = (e) => {
        e.stopPropagation();
        openRazorpayCheckout();
      };
      card.appendChild(overlay);
    } else {
      card.onclick = () => {
        window.location.href = `quiz.html?subject=${encodeURIComponent(subject.name)}`;
      };
    }

    return card;
  }

  function renderSubjects(isPaid) {
    subjectContainer.innerHTML = "";
    const years = [...new Set(subjects.map(s => s.year))];

    years.forEach(year => {
      const h2 = document.createElement("h2");
      h2.textContent = year;
      subjectContainer.appendChild(h2);

      const yearSubjects = subjects.filter(s => s.year === year);

      yearSubjects.forEach(subject => {
        const unlocked = (subject.name === "Anatomy") || isPaid;
        const card = createSubjectCard(subject, unlocked);
        subjectContainer.appendChild(card);
      });
    });
  }

  function openRazorpayCheckout() {
    const user = auth.currentUser;
    if (!user) {
      alert("Please login to pay.");
      return;
    }

    const options = {
      key: razorpayKey,
      amount: 9900, // â‚¹99 in paise
      currency: "INR",
      name: "NEET PG Quiz",
      description: "Unlock all subjects except Anatomy",
      handler: function (response) {
        alert("Payment successful! Payment ID: " + response.razorpay_payment_id);
        db.collection('users').doc(user.uid).set({ isPaid: true }, { merge: true })
          .then(() => {
            renderSubjects(true);
          })
          .catch(err => alert("Failed to update payment status: " + err.message));
      },
      prefill: { email: user.email },
      theme: { color: "#344ea3" }
    };
    const rzp = new Razorpay(options);
    rzp.open();
  }

  logoutBtn.onclick = () => {
    auth.signOut();
  };

  auth.onAuthStateChanged(user => {
    if (user) {
      logoutBtn.style.display = "block";
      db.collection('users').doc(user.uid).get()
        .then(doc => {
          const isPaid = doc.exists && doc.data().isPaid;
          renderSubjects(isPaid);
        })
        .catch(() => renderSubjects(false));
    } else {
      logoutBtn.style.display = "none";
      renderSubjects(false);
    }
  });
</script>

</body>
</html>
