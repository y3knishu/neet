<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NEET PG Quiz Homepage</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(45deg, #ff0057, #ffec00, #00ff6a, #006eff, #ff00e0);
    min-height: 100vh;
    margin: 0;
    color: #fff;
  }
  header {
    display: flex;
    justify-content: space-between;
    padding: 15px 30px;
    background: rgba(0,0,0,0.4);
    align-items: center;
  }
  #loginBtn, #logoutBtn {
    background: #fff;
    color: #333;
    border: none;
    padding: 8px 16px;
    font-weight: bold;
    border-radius: 5px;
    cursor: pointer;
  }
  h1 {
    text-align: center;
    margin-top: 20px;
    font-weight: 700;
    text-shadow: 1px 1px 5px rgba(0,0,0,0.6);
  }
  #subjectsContainer {
    max-width: 1000px;
    margin: 20px auto;
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
    gap: 15px;
    padding: 0 15px 40px;
  }
  .subject-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    user-select: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    color: #000;
    cursor: pointer;
    position: relative;
    transition: transform 0.2s ease;
  }
  .subject-card:hover:not(.locked) {
    transform: scale(1.05);
  }
  /* Year group colors */
  .year-1 { background: #ff6f61; color: white; }
  .year-2 { background: #6b5b95; color: white; }
  .year-3 { background: #88b04b; color: white; }
  .final-year { background: #f7cac9; color: #333; }

  /* Locked overlay */
  .locked {
    cursor: not-allowed;
    opacity: 0.6;
  }
  .locked::after {
    content: "ðŸ”’ Pay â‚¹99 to unlock";
    color: #b00;
    font-weight: 700;
    font-size: 14px;
    position: absolute;
    bottom: 10px;
    width: 100%;
    left: 0;
  }

  /* Progress bar container */
  .progress-bar {
    height: 8px;
    background: #ddd;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 15px;
  }
  .progress-correct {
    height: 100%;
    background: #4caf50;
  }
  .progress-wrong {
    height: 100%;
    background: #f44336;
  }
  .progress-unattempted {
    height: 100%;
    background: #bbb;
  }

  /* Floating WhatsApp Help Button */
  #whatsappHelp {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background: #25d366;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #whatsappHelp img {
    width: 35px;
    height: 35px;
  }
</style>
</head>
<body>

<header>
  <div><strong>NEET PG Quiz</strong></div>
  <div>
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<h1>Choose Your Subject</h1>
<div id="subjectsContainer"></div>

<!-- WhatsApp Help Button -->
<a id="whatsappHelp" href="https://wa.me/919431328569" target="_blank" title="WhatsApp Help">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" />
</a>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDr3_9dpo55esyfpkwsAjfFi_1KMu0ZDrU",
    authDomain: "neet-88499.firebaseapp.com",
    projectId: "neet-88499",
    storageBucket: "neet-88499.firebasestorage.app",
    messagingSenderId: "889163298965",
    appId: "1:889163298965:web:fbae28b0ba478cff2f839c",
    measurementId: "G-GEG090K2JQ"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const subjectsContainer = document.getElementById("subjectsContainer");

  // Subject list with years and payment lock info
  const subjects = [
    { name: "Anatomy", year: "year-1", free: true },
    { name: "Physiology", year: "year-1", free: false },
    { name: "Biochemistry", year: "year-1", free: false },

    { name: "Pathology", year: "year-2", free: false },
    { name: "Pharmacology", year: "year-2", free: false },
    { name: "Microbiology", year: "year-2", free: false },
    { name: "Forensic Medicine", year: "year-2", free: false },

    { name: "Community Medicine", year: "year-3", free: false },
    { name: "ENT", year: "year-3", free: false },
    { name: "Ophthalmology", year: "year-3", free: false },

    { name: "General Medicine", year: "final-year", free: false },
    { name: "General Surgery", year: "final-year", free: false },
    { name: "Obstetrics & Gynaecology", year: "final-year", free: false },
    { name: "Pediatrics", year: "final-year", free: false },
    { name: "Orthopaedics", year: "final-year", free: false },
    { name: "Dermatology", year: "final-year", free: false },
    { name: "Psychiatry", year: "final-year", free: false },
    { name: "Respiratory Medicine", year: "final-year", free: false },
    { name: "Anesthesiology", year: "final-year", free: false }
  ];

  let currentUser = null;
  let userPaid = false; // Will check from Firestore user doc

  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(e => alert("Login failed: " + e.message));
  };
  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(async user => {
    currentUser = user;
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      // Check payment status from Firestore
      const userDoc = await db.collection("users").doc(user.uid).get();
      userPaid = userDoc.exists && userDoc.data().isPaid === true;
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      userPaid = false;
    }
    renderSubjects();
  });

  function renderSubjects() {
    subjectsContainer.innerHTML = "";
    subjects.forEach(subj => {
      const card = document.createElement("div");
      card.className = `subject-card ${subj.year}`;
      card.textContent = subj.name;

      // Determine locked/unlocked
      const unlocked = subj.free || (currentUser && userPaid);
      if (!unlocked) {
        card.classList.add("locked");
        card.title = "Please pay â‚¹99 to unlock this subject";
      } else {
        card.onclick = () => {
          window.location.href = `quiz.html?subject=${encodeURIComponent(subj.name)}`;
        };
      }

      // Add progress bar container
      const progressBar = document.createElement("div");
      progressBar.className = "progress-bar";

      // Fetch progress from Firestore if user logged in and unlocked
      if (currentUser && unlocked) {
        db.collection("users").doc(currentUser.uid)
          .collection("progress").doc(subj.name)
          .get()
          .then(doc => {
            if (doc.exists) {
              const data = doc.data();
              const total = data.totalQuestions || 0;
              const correct = data.correct || 0;
              const wrong = data.wrong || 0;
              const attempted = correct + wrong;
              const unattempted = total - attempted;

              progressBar.innerHTML = `
                <div class="progress-correct" style="width: ${(correct/total)*100 || 0}%;"></div>
                <div class="progress-wrong" style="width: ${(wrong/total)*100 || 0}%;"></div>
                <div class="progress-unattempted" style="width: ${(unattempted/total)*100 || 0}%;"></div>
              `;
            }
          }).catch(console.error);
      }

      card.appendChild(progressBar);
      subjectsContainer.appendChild(card);
    });
  }
</script>

</body>
</html>
