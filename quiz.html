<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NEET PG Quiz</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 30px auto; }
  h2 { margin-bottom: 5px; }
  .option { padding: 10px; margin: 6px 0; border: 1px solid #999; border-radius: 5px; cursor: pointer; }
  .option.correct { background-color: #4CAF50; color: white; }
  .option.wrong { background-color: #f44336; color: white; }
  #navigation { margin-top: 20px; }
  button { padding: 8px 15px; margin-right: 10px; }
</style>
</head>
<body>

<h1 id="quizTitle">Quiz</h1>
<div id="questionContainer">
  <h2 id="questionText">Loading...</h2>
  <div id="optionsContainer"></div>
</div>

<div id="navigation">
  <button id="prevBtn" disabled>Previous</button>
  <button id="nextBtn" disabled>Next</button>
  <button id="submitBtn" disabled>Submit</button>
</div>

<div id="result" style="margin-top: 30px; font-weight: bold;"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
// Your firebaseConfig here (replace with your config)
const firebaseConfig = {
  apiKey: "AIzaSyDr3_9dpo55esyfpkwsAjfFi_1KMu0ZDrU",
  authDomain: "neet-88499.firebaseapp.com",
  projectId: "neet-88499",
  storageBucket: "neet-88499.firebasestorage.app",
  messagingSenderId: "889163298965",
  appId: "1:889163298965:web:fbae28b0ba478cff2f839c",
  measurementId: "G-GEG090K2JQ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const urlParams = new URLSearchParams(window.location.search);
const subject = urlParams.get("subject");
if (!subject) {
  alert("Subject not specified!");
  window.location.href = "index.html";
}

document.getElementById("quizTitle").innerText = `Quiz: ${subject}`;

let questions = [];
let currentIndex = 0;
let selectedAnswers = []; // store user's selected option index per question

const questionText = document.getElementById("questionText");
const optionsContainer = document.getElementById("optionsContainer");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const submitBtn = document.getElementById("submitBtn");
const resultDiv = document.getElementById("result");

// Fetch questions for the subject
db.collection("questions")
  .where("subject", "==", subject)
  .orderBy("questionNumber")
  .get()
  .then(snapshot => {
    if (snapshot.empty) {
      alert("No questions found for " + subject);
      window.location.href = "index.html";
      return;
    }
    questions = snapshot.docs.map(doc => doc.data());
    selectedAnswers = Array(questions.length).fill(null);
    renderQuestion();
    updateButtons();
  })
  .catch(err => {
    console.error(err);
    alert("Failed to load questions.");
  });

// Render current question and options
function renderQuestion() {
  const q = questions[currentIndex];
  questionText.textContent = `${currentIndex + 1}. ${q.question}`;
  optionsContainer.innerHTML = "";

  q.options.forEach((opt, i) => {
    const optDiv = document.createElement("div");
    optDiv.classList.add("option");
    optDiv.textContent = opt;

    // If question has image URL, show image
    if (i === 0 && q.imageUrl) {
      const img = document.createElement("img");
      img.src = q.imageUrl;
      img.style.maxWidth = "100%";
      img.style.marginBottom = "10px";
      optionsContainer.prepend(img);
    }

    // If already answered, color green/red accordingly
    if (selectedAnswers[currentIndex] !== null) {
      if (i === q.answer) {
        optDiv.classList.add("correct");
      }
      if (i === selectedAnswers[currentIndex] && selectedAnswers[currentIndex] !== q.answer) {
        optDiv.classList.add("wrong");
      }
    } else {
      optDiv.onclick = () => {
        selectedAnswers[currentIndex] = i;
        renderQuestion(); // re-render to update colors
        updateButtons();
      };
    }

    optionsContainer.appendChild(optDiv);
  });
}

function updateButtons() {
  prevBtn.disabled = currentIndex === 0;
  nextBtn.disabled = currentIndex === questions.length - 1;
  submitBtn.disabled = selectedAnswers.includes(null);
}

prevBtn.onclick = () => {
  if (currentIndex > 0) {
    currentIndex--;
    renderQuestion();
    updateButtons();
    resultDiv.textContent = "";
  }
};

nextBtn.onclick = () => {
  if (currentIndex < questions.length - 1) {
    currentIndex++;
    renderQuestion();
    updateButtons();
    resultDiv.textContent = "";
  }
};

submitBtn.onclick = () => {
  let correctCount = 0;
  questions.forEach((q, i) => {
    if (selectedAnswers[i] === q.answer) correctCount++;
  });
  resultDiv.textContent = `You scored ${correctCount} out of ${questions.length}`;
  // Disable options and navigation after submit
  submitBtn.disabled = true;
  nextBtn.disabled = true;
  prevBtn.disabled = true;
};
</script>

</body>
</html>
